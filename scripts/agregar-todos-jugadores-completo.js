const axios = require('axios');
require('dotenv').config({ path: '../.env' });

const API_BASE_URL = process.env.API_BASE_URL || 'http://localhost:3000/api';
const EVENTO_LIGA_2024 = '68db0409ddcdb45a97d57ffd';

// Mapeo de equipos
const equiposIds = {
  'BUMBA': '68e42f7caa241db4750498ae',
  'THE CATCHERS': '68e42f78aa241db4750498ab',
  'THE DODGEBALL MONKEYS': '68e45aa2a8e4d976e9a083d2',
  'LA NEOFARAFA': '68e45aa1a8e4d976e9a083cf'
};

// Todos los 22 jugadores que me proporcionaste
const todosLosJugadores = [
  {
    nombre: 'Felipe',
    apellido: 'Demarco',
    equipo: 'BUMBA',
    setsJugados: 9,
    tirosTotales: 61,
    hits: 20,
    quemados: 18,
    asistencias: 2,
    tirosRecibidos: 47,
    hitsRecibidos: 22,
    esquives: 3,
    esquivesSinEsfuerzo: 15,
    ponchado: 6,
    catchesIntentados: 1,
    catches: 0,
    bloqueosIntentados: 19,
    bloqueos: 18,
    pisoLinea: 0,
    catchesRecibidos: 0,
    porcentajeHits: 32.8,
    porcentajeOuts: 29.5,
    porcentajeCatches: 0.0,
    porcentajeBloqueos: 81.8,
    indiceAtaque: 10.08,
    indiceDefensa: 5.79,
    indicePoder: 90.62
  },
  {
    nombre: 'Alejandro',
    apellido: 'Rocca',
    equipo: 'THE DODGEBALL MONKEYS',
    setsJugados: 11,
    tirosTotales: 68,
    hits: 26,
    quemados: 19,
    asistencias: 2,
    tirosRecibidos: 22,
    hitsRecibidos: 15,
    esquives: 4,
    esquivesSinEsfuerzo: 3,
    ponchado: 6,
    catchesIntentados: 1,
    catches: 1,
    bloqueosIntentados: 10,
    bloqueos: 8,
    pisoLinea: 0,
    catchesRecibidos: 0,
    porcentajeHits: 38.2,
    porcentajeOuts: 27.9,
    porcentajeCatches: 6.7,
    porcentajeBloqueos: 53.3,
    indiceAtaque: 10.35,
    indiceDefensa: 3.59,
    indicePoder: 81.03
  },
  {
    nombre: 'Guzmán',
    apellido: 'Demarco',
    equipo: 'THE CATCHERS',
    setsJugados: 9,
    tirosTotales: 63,
    hits: 23,
    quemados: 20,
    asistencias: 4,
    tirosRecibidos: 20,
    hitsRecibidos: 7,
    esquives: 6,
    esquivesSinEsfuerzo: 4,
    ponchado: 6,
    catchesIntentados: 2,
    catches: 0,
    bloqueosIntentados: 2,
    bloqueos: 2,
    pisoLinea: 0,
    catchesRecibidos: 0,
    porcentajeHits: 36.5,
    porcentajeOuts: 31.7,
    porcentajeCatches: 0.0,
    porcentajeBloqueos: 28.6,
    indiceAtaque: 11.77,
    indiceDefensa: 1.36,
    indicePoder: 77.65
  },
  {
    nombre: 'Rafael',
    apellido: 'García',
    equipo: 'LA NEOFARAFA',
    setsJugados: 11,
    tirosTotales: 73,
    hits: 21,
    quemados: 14,
    asistencias: 1,
    tirosRecibidos: 35,
    hitsRecibidos: 14,
    esquives: 5,
    esquivesSinEsfuerzo: 16,
    ponchado: 8,
    catchesIntentados: 2,
    catches: 2,
    bloqueosIntentados: 6,
    bloqueos: 6,
    pisoLinea: 1,
    catchesRecibidos: 1,
    porcentajeHits: 28.8,
    porcentajeOuts: 19.2,
    porcentajeCatches: 14.3,
    porcentajeBloqueos: 42.9,
    indiceAtaque: 7.63,
    indiceDefensa: 5.66,
    indicePoder: 76.49
  },
  {
    nombre: 'Valentino',
    apellido: 'Gloodtdfosky',
    equipo: 'THE DODGEBALL MONKEYS',
    setsJugados: 11,
    tirosTotales: 63,
    hits: 23,
    quemados: 18,
    asistencias: 1,
    tirosRecibidos: 20,
    hitsRecibidos: 5,
    esquives: 5,
    esquivesSinEsfuerzo: 9,
    ponchado: 5,
    catchesIntentados: 2,
    catches: 1,
    bloqueosIntentados: 2,
    bloqueos: 2,
    pisoLinea: 0,
    catchesRecibidos: 1,
    porcentajeHits: 36.5,
    porcentajeOuts: 28.6,
    porcentajeCatches: 20.0,
    porcentajeBloqueos: 40.0,
    indiceAtaque: 9.21,
    indiceDefensa: 3.80,
    indicePoder: 75.81
  },
  {
    nombre: 'Salvador',
    apellido: 'Méndez',
    equipo: 'THE DODGEBALL MONKEYS',
    setsJugados: 11,
    tirosTotales: 28,
    hits: 8,
    quemados: 8,
    asistencias: 1,
    tirosRecibidos: 32,
    hitsRecibidos: 8,
    esquives: 7,
    esquivesSinEsfuerzo: 17,
    ponchado: 5,
    catchesIntentados: 1,
    catches: 1,
    bloqueosIntentados: 4,
    bloqueos: 4,
    pisoLinea: 1,
    catchesRecibidos: 0,
    porcentajeHits: 28.6,
    porcentajeOuts: 28.6,
    porcentajeCatches: 12.5,
    porcentajeBloqueos: 50.0,
    indiceAtaque: 4.07,
    indiceDefensa: 4.89,
    indicePoder: 52.92
  },
  {
    nombre: 'Edewel',
    apellido: 'Cremel',
    equipo: 'THE CATCHERS',
    setsJugados: 9,
    tirosTotales: 34,
    hits: 12,
    quemados: 3,
    asistencias: 2,
    tirosRecibidos: 34,
    hitsRecibidos: 10,
    esquives: 7,
    esquivesSinEsfuerzo: 16,
    ponchado: 8,
    catchesIntentados: 0,
    catches: 0,
    bloqueosIntentados: 5,
    bloqueos: 5,
    pisoLinea: 0,
    catchesRecibidos: 1,
    porcentajeHits: 35.3,
    porcentajeOuts: 8.8,
    porcentajeCatches: 0.0,
    porcentajeBloqueos: 50.0,
    indiceAtaque: 3.48,
    indiceDefensa: 3.03,
    indicePoder: 40.30
  },
  {
    nombre: 'Gerónimo',
    apellido: 'Nicola',
    equipo: 'LA NEOFARAFA',
    setsJugados: 11,
    tirosTotales: 49,
    hits: 16,
    quemados: 9,
    asistencias: 3,
    tirosRecibidos: 15,
    hitsRecibidos: 10,
    esquives: 0,
    esquivesSinEsfuerzo: 5,
    ponchado: 8,
    catchesIntentados: 1,
    catches: 1,
    bloqueosIntentados: 2,
    bloqueos: 1,
    pisoLinea: 0,
    catchesRecibidos: 1,
    porcentajeHits: 32.7,
    porcentajeOuts: 18.4,
    porcentajeCatches: 10.0,
    porcentajeBloqueos: 10.0,
    indiceAtaque: 5.84,
    indiceDefensa: 0.40,
    indicePoder: 40.05
  },
  {
    nombre: 'Agustín',
    apellido: 'Giles',
    equipo: 'BUMBA',
    setsJugados: 9,
    tirosTotales: 35,
    hits: 8,
    quemados: 7,
    asistencias: 1,
    tirosRecibidos: 18,
    hitsRecibidos: 7,
    esquives: 3,
    esquivesSinEsfuerzo: 8,
    ponchado: 7,
    catchesIntentados: 1,
    catches: 1,
    bloqueosIntentados: 1,
    bloqueos: 1,
    pisoLinea: 0,
    catchesRecibidos: 0,
    porcentajeHits: 22.9,
    porcentajeOuts: 20.0,
    porcentajeCatches: 14.3,
    porcentajeBloqueos: 14.3,
    indiceAtaque: 4.08,
    indiceDefensa: 2.28,
    indicePoder: 39.85
  },
  {
    nombre: 'Santiago',
    apellido: 'Giles',
    equipo: 'BUMBA',
    setsJugados: 9,
    tirosTotales: 19,
    hits: 8,
    quemados: 8,
    asistencias: 2,
    tirosRecibidos: 14,
    hitsRecibidos: 6,
    esquives: 3,
    esquivesSinEsfuerzo: 4,
    ponchado: 5,
    catchesIntentados: 0,
    catches: 0,
    bloqueosIntentados: 2,
    bloqueos: 2,
    pisoLinea: 0,
    catchesRecibidos: 0,
    porcentajeHits: 42.1,
    porcentajeOuts: 42.1,
    porcentajeCatches: 0.0,
    porcentajeBloqueos: 33.3,
    indiceAtaque: 4.86,
    indiceDefensa: 0.80,
    indicePoder: 36.61
  },
  {
    nombre: 'Patricia',
    apellido: 'Yanes',
    equipo: 'LA NEOFARAFA',
    setsJugados: 9,
    tirosTotales: 15,
    hits: 3,
    quemados: 2,
    asistencias: 1,
    tirosRecibidos: 25,
    hitsRecibidos: 13,
    esquives: 1,
    esquivesSinEsfuerzo: 11,
    ponchado: 8,
    catchesIntentados: 4,
    catches: 3,
    bloqueosIntentados: 1,
    bloqueos: 1,
    pisoLinea: 0,
    catchesRecibidos: 0,
    porcentajeHits: 20.0,
    porcentajeOuts: 13.3,
    porcentajeCatches: 23.1,
    porcentajeBloqueos: 7.7,
    indiceAtaque: 1.56,
    indiceDefensa: 4.37,
    indicePoder: 36.43
  },
  {
    nombre: 'Josué',
    apellido: 'Arboleda',
    equipo: 'LA NEOFARAFA',
    setsJugados: 8,
    tirosTotales: 21,
    hits: 2,
    quemados: 0,
    asistencias: 0,
    tirosRecibidos: 37,
    hitsRecibidos: 14,
    esquives: 13,
    esquivesSinEsfuerzo: 10,
    ponchado: 5,
    catchesIntentados: 0,
    catches: 0,
    bloqueosIntentados: 10,
    bloqueos: 9,
    pisoLinea: 0,
    catchesRecibidos: 1,
    porcentajeHits: 9.5,
    porcentajeOuts: 0.0,
    porcentajeCatches: 0.0,
    porcentajeBloqueos: 64.3,
    indiceAtaque: 0.19,
    indiceDefensa: 5.64,
    indicePoder: 35.27
  },
  {
    nombre: 'Matheo',
    apellido: 'Santos',
    equipo: 'THE DODGEBALL MONKEYS',
    setsJugados: 11,
    tirosTotales: 8,
    hits: 2,
    quemados: 1,
    asistencias: 0,
    tirosRecibidos: 28,
    hitsRecibidos: 8,
    esquives: 5,
    esquivesSinEsfuerzo: 13,
    ponchado: 8,
    catchesIntentados: 4,
    catches: 2,
    bloqueosIntentados: 1,
    bloqueos: 1,
    pisoLinea: 1,
    catchesRecibidos: 1,
    porcentajeHits: 25.0,
    porcentajeOuts: 12.5,
    porcentajeCatches: 25.0,
    porcentajeBloqueos: 12.5,
    indiceAtaque: 0.55,
    indiceDefensa: 4.62,
    indicePoder: 32.10
  },
  {
    nombre: 'Diego',
    apellido: 'Burrera',
    equipo: 'BUMBA',
    setsJugados: 9,
    tirosTotales: 29,
    hits: 7,
    quemados: 5,
    asistencias: 0,
    tirosRecibidos: 26,
    hitsRecibidos: 7,
    esquives: 7,
    esquivesSinEsfuerzo: 11,
    ponchado: 7,
    catchesIntentados: 1,
    catches: 0,
    bloqueosIntentados: 2,
    bloqueos: 1,
    pisoLinea: 1,
    catchesRecibidos: 0,
    porcentajeHits: 24.1,
    porcentajeOuts: 17.2,
    porcentajeCatches: 0.0,
    porcentajeBloqueos: 14.3,
    indiceAtaque: 2.98,
    indiceDefensa: 1.39,
    indicePoder: 29.23
  },
  {
    nombre: 'Rodrigo',
    apellido: 'Pérez',
    equipo: 'LA NEOFARAFA',
    setsJugados: 10,
    tirosTotales: 16,
    hits: 7,
    quemados: 3,
    asistencias: 0,
    tirosRecibidos: 24,
    hitsRecibidos: 9,
    esquives: 6,
    esquivesSinEsfuerzo: 9,
    ponchado: 10,
    catchesIntentados: 1,
    catches: 1,
    bloqueosIntentados: 0,
    bloqueos: 0,
    pisoLinea: 1,
    catchesRecibidos: 0,
    porcentajeHits: 43.8,
    porcentajeOuts: 18.8,
    porcentajeCatches: 11.1,
    porcentajeBloqueos: 0.0,
    indiceAtaque: 2.26,
    indiceDefensa: 1.90,
    indicePoder: 27.82
  },
  {
    nombre: 'Tiago',
    apellido: 'Pereira',
    equipo: 'THE DODGEBALL MONKEYS',
    setsJugados: 11,
    tirosTotales: 18,
    hits: 7,
    quemados: 2,
    asistencias: 0,
    tirosRecibidos: 21,
    hitsRecibidos: 5,
    esquives: 4,
    esquivesSinEsfuerzo: 13,
    ponchado: 6,
    catchesIntentados: 0,
    catches: 0,
    bloqueosIntentados: 2,
    bloqueos: 1,
    pisoLinea: 0,
    catchesRecibidos: 2,
    porcentajeHits: 38.9,
    porcentajeOuts: 11.1,
    porcentajeCatches: 0.0,
    porcentajeBloqueos: 20.0,
    indiceAtaque: 1.48,
    indiceDefensa: 1.23,
    indicePoder: 20.18
  },
  {
    nombre: 'Facundo',
    apellido: 'Alonso',
    equipo: 'THE CATCHERS',
    setsJugados: 9,
    tirosTotales: 19,
    hits: 8,
    quemados: 1,
    asistencias: 1,
    tirosRecibidos: 20,
    hitsRecibidos: 8,
    esquives: 8,
    esquivesSinEsfuerzo: 3,
    ponchado: 8,
    catchesIntentados: 0,
    catches: 0,
    bloqueosIntentados: 1,
    bloqueos: 0,
    pisoLinea: 0,
    catchesRecibidos: 0,
    porcentajeHits: 42.1,
    porcentajeOuts: 5.3,
    porcentajeCatches: 0.0,
    porcentajeBloqueos: 0.0,
    indiceAtaque: 2.07,
    indiceDefensa: 0.33,
    indicePoder: 18.85
  },
  {
    nombre: 'Ignacio',
    apellido: 'Rodríguez',
    equipo: 'THE DODGEBALL MONKEYS',
    setsJugados: 11,
    tirosTotales: 4,
    hits: 3,
    quemados: 0,
    asistencias: 1,
    tirosRecibidos: 15,
    hitsRecibidos: 6,
    esquives: 3,
    esquivesSinEsfuerzo: 6,
    ponchado: 6,
    catchesIntentados: 0,
    catches: 0,
    bloqueosIntentados: 2,
    bloqueos: 2,
    pisoLinea: 0,
    catchesRecibidos: 2,
    porcentajeHits: 75.0,
    porcentajeOuts: 0.0,
    porcentajeCatches: 0.0,
    porcentajeBloqueos: 33.3,
    indiceAtaque: 0.53,
    indiceDefensa: 0.88,
    indicePoder: 13.16
  },
  {
    nombre: 'Santiago',
    apellido: 'Gil',
    equipo: 'LA NEOFARAFA',
    setsJugados: 8,
    tirosTotales: 2,
    hits: 0,
    quemados: 0,
    asistencias: 1,
    tirosRecibidos: 19,
    hitsRecibidos: 10,
    esquives: 3,
    esquivesSinEsfuerzo: 6,
    ponchado: 8,
    catchesIntentados: 0,
    catches: 0,
    bloqueosIntentados: 5,
    bloqueos: 3,
    pisoLinea: 1,
    catchesRecibidos: 0,
    porcentajeHits: 0.0,
    porcentajeOuts: 0.0,
    porcentajeCatches: 0.0,
    porcentajeBloqueos: 30.0,
    indiceAtaque: 0.45,
    indiceDefensa: 0.20,
    indicePoder: 9.28
  },
  {
    nombre: 'Agustín',
    apellido: 'Sogliano',
    equipo: 'LA NEOFARAFA',
    setsJugados: 9,
    tirosTotales: 7,
    hits: 2,
    quemados: 0,
    asistencias: 0,
    tirosRecibidos: 10,
    hitsRecibidos: 5,
    esquives: 4,
    esquivesSinEsfuerzo: 0,
    ponchado: 7,
    catchesIntentados: 0,
    catches: 0,
    bloqueosIntentados: 0,
    bloqueos: 0,
    pisoLinea: 1,
    catchesRecibidos: 1,
    porcentajeHits: 28.6,
    porcentajeOuts: 0.0,
    porcentajeCatches: 0.0,
    porcentajeBloqueos: 0.0,
    indiceAtaque: 0.20,
    indiceDefensa: -0.03,
    indicePoder: 6.72
  },
  {
    nombre: 'Mateo',
    apellido: 'Alonso',
    equipo: 'THE CATCHERS',
    setsJugados: 9,
    tirosTotales: 6,
    hits: 0,
    quemados: 0,
    asistencias: 1,
    tirosRecibidos: 15,
    hitsRecibidos: 7,
    esquives: 4,
    esquivesSinEsfuerzo: 3,
    ponchado: 8,
    catchesIntentados: 0,
    catches: 0,
    bloqueosIntentados: 1,
    bloqueos: 0,
    pisoLinea: 1,
    catchesRecibidos: 0,
    porcentajeHits: 0.0,
    porcentajeOuts: 0.0,
    porcentajeCatches: 0.0,
    porcentajeBloqueos: 0.0,
    indiceAtaque: 0.31,
    indiceDefensa: -0.46,
    indicePoder: 5.18
  },
  {
    nombre: 'Pastor',
    apellido: '',
    equipo: 'BUMBA',
    setsJugados: 9,
    tirosTotales: 4,
    hits: 0,
    quemados: 0,
    asistencias: 0,
    tirosRecibidos: 10,
    hitsRecibidos: 4,
    esquives: 0,
    esquivesSinEsfuerzo: 4,
    ponchado: 6,
    catchesIntentados: 0,
    catches: 0,
    bloqueosIntentados: 0,
    bloqueos: 0,
    pisoLinea: 0,
    catchesRecibidos: 0,
    porcentajeHits: 0.0,
    porcentajeOuts: 0.0,
    porcentajeCatches: 0.0,
    porcentajeBloqueos: 0.0,
    indiceAtaque: 0.00,
    indiceDefensa: -0.57,
    indicePoder: 2.91
  },
  {
    nombre: 'Santino',
    apellido: 'Barreiro',
    equipo: 'BUMBA',
    setsJugados: 9,
    tirosTotales: 5,
    hits: 0,
    quemados: 0,
    asistencias: 0,
    tirosRecibidos: 6,
    hitsRecibidos: 5,
    esquives: 0,
    esquivesSinEsfuerzo: 1,
    ponchado: 5,
    catchesIntentados: 0,
    catches: 0,
    bloqueosIntentados: 0,
    bloqueos: 0,
    pisoLinea: 0,
    catchesRecibidos: 0,
    porcentajeHits: 0.0,
    porcentajeOuts: 0.0,
    porcentajeCatches: 0.0,
    porcentajeBloqueos: 0.0,
    indiceAtaque: 0.00,
    indiceDefensa: -1.14,
    indicePoder: 0.00
  }
];

async function agregarTodosLosJugadores() {
  try {
    console.log('🔄 Agregando todos los 22 jugadores...\n');

    let estadisticasCreadas = 0;
    let errores = 0;

    for (const jugador of todosLosJugadores) {
      console.log(`🔄 Procesando ${jugador.nombre} ${jugador.apellido}...`);
      
      try {
        // Crear estadística directamente (asumiendo que los jugadores ya existen)
        const equipoId = equiposIds[jugador.equipo];
        if (!equipoId) {
          console.log(`   ❌ ID de equipo no encontrado para ${jugador.equipo}`);
          errores++;
          continue;
        }

        // Buscar jugador existente
        const jugadoresResponse = await axios.get(`${API_BASE_URL}/jugadores`);
        const jugadores = jugadoresResponse.data.data.jugadores || jugadoresResponse.data.data;
        
        const jugadorExistente = jugadores.find(j => 
          j.usuario.nombre === jugador.nombre && 
          j.usuario.apellido === jugador.apellido
        );

        if (!jugadorExistente) {
          console.log(`   ⚠️  Jugador ${jugador.nombre} ${jugador.apellido} no encontrado. Saltando.`);
          errores++;
          continue;
        }

        // Verificar si ya existe estadística
        const estadisticasResponse = await axios.get(`${API_BASE_URL}/estadisticas?evento=${EVENTO_LIGA_2024}`);
        const estadisticasExistentes = estadisticasResponse.data.data;
        
        const estadisticaExistente = estadisticasExistentes.find(e => 
          e.jugador._id === jugadorExistente._id
        );

        if (estadisticaExistente) {
          console.log(`   ✅ Estadística ya existe para ${jugador.nombre} ${jugador.apellido}`);
          continue;
        }

        // Crear nueva estadística
        const estadisticaResponse = await axios.post(`${API_BASE_URL}/estadisticas`, {
          equipo: equipoId,
          jugador: jugadorExistente._id,
          evento: EVENTO_LIGA_2024,
          setsJugados: jugador.setsJugados,
          tirosTotales: jugador.tirosTotales,
          hits: jugador.hits,
          quemados: jugador.quemados,
          asistencias: jugador.asistencias,
          tirosRecibidos: jugador.tirosRecibidos,
          hitsRecibidos: jugador.hitsRecibidos,
          esquives: jugador.esquives,
          esquivesSinEsfuerzo: jugador.esquivesSinEsfuerzo,
          ponchado: jugador.ponchado,
          catchesIntentados: jugador.catchesIntentados,
          catches: jugador.catches,
          bloqueosIntentados: jugador.bloqueosIntentados,
          bloqueos: jugador.bloqueos,
          pisoLinea: jugador.pisoLinea,
          catchesRecibidos: jugador.catchesRecibidos,
          porcentajeHits: jugador.porcentajeHits,
          porcentajeOuts: jugador.porcentajeOuts,
          porcentajeCatches: jugador.porcentajeCatches,
          porcentajeBloqueos: jugador.porcentajeBloqueos,
          indiceAtaque: jugador.indiceAtaque,
          indiceDefensa: jugador.indiceDefensa,
          indicePoder: jugador.indicePoder,
          temporada: '2024-2025',
          activo: true
        });
        
        console.log(`   ✅ Estadística creada - Poder: ${jugador.indicePoder}`);
        estadisticasCreadas++;

      } catch (error) {
        console.error(`   ❌ Error procesando ${jugador.nombre} ${jugador.apellido}: ${error.message}`);
        errores++;
      }
    }

    console.log('\n📈 Resumen del procesamiento:');
    console.log(`   📊 Estadísticas creadas: ${estadisticasCreadas}`);
    console.log(`   ❌ Errores: ${errores}`);
    console.log(`   📊 Total procesados: ${todosLosJugadores.length}`);

    // Verificar estadísticas finales
    console.log('\n🔍 Verificando estadísticas finales...');
    const estadisticasFinalesResponse = await axios.get(`${API_BASE_URL}/estadisticas?evento=${EVENTO_LIGA_2024}`);
    const estadisticasFinales = estadisticasFinalesResponse.data.data;

    console.log(`\n📊 Total de estadísticas en la BD: ${estadisticasFinales.length}`);

    console.log('\n🏆 Ranking final por índice de poder:');
    estadisticasFinales
      .sort((a, b) => b.indicePoder - a.indicePoder)
      .forEach((e, i) => {
        console.log(`   ${i + 1}. ${e.jugador.nombre} ${e.jugador.apellido} - ${e.equipo.nombre} - Poder: ${e.indicePoder}`);
      });

    console.log('\n🎉 Procesamiento completado!');
  } catch (error) {
    console.error('❌ Error en el procesamiento:', error.message);
  } finally {
    console.log('✅ Script completado');
  }
}

agregarTodosLosJugadores();
